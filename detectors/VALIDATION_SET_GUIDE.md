# éªŒè¯é›†ä½¿ç”¨æŒ‡å—

## ğŸ¯ ä»€ä¹ˆæ˜¯éªŒè¯é›†ï¼Ÿ

åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œæ•°æ®é›†é€šå¸¸åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š

```
å®Œæ•´æ•°æ®é›†
â”œâ”€â”€ è®­ç»ƒé›† (Training Set) - 60%     # è®­ç»ƒæ¨¡å‹
â”œâ”€â”€ éªŒè¯é›† (Validation Set) - 20%   # è°ƒå‚ã€ä¼˜åŒ–é˜ˆå€¼ â­
â””â”€â”€ æµ‹è¯•é›† (Test Set) - 20%         # æœ€ç»ˆè¯„ä¼°
```

**ä½ çš„æƒ…å†µ**ï¼š
- ä½ ç”¨çš„æ˜¯**é¢„è®­ç»ƒæ¨¡å‹**ï¼ˆBARTã€DeBERTaï¼‰ï¼Œä¸éœ€è¦è®­ç»ƒé›†
- æ‰€ä»¥åªéœ€è¦åˆ†å‰²ä¸ºï¼š**éªŒè¯é›† + æµ‹è¯•é›†**

---

## ğŸ“Š ä½ çš„æ•°æ®é›†ç°çŠ¶

å½“å‰ä½ åªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼š
```
test_response_label.jsonl - 17,790 æ ·æœ¬
  â”œâ”€â”€ æœ‰å¹»è§‰: 7,664 (43.08%)
  â””â”€â”€ æ— å¹»è§‰: 10,126 (56.92%)
```

**é—®é¢˜**ï¼š
- âŒ ä½ åœ¨è¿™ä¸ªæ•°æ®é›†ä¸Š**åŒæ—¶**ä¼˜åŒ–é˜ˆå€¼å’Œè¯„ä¼°æ€§èƒ½
- âŒ è¿™å¯¼è‡´**è¿‡æ‹Ÿåˆ**ï¼ˆé˜ˆå€¼æ˜¯é’ˆå¯¹è¿™ä¸ªç‰¹å®šæ•°æ®é›†ä¼˜åŒ–çš„ï¼‰
- âŒ æ€§èƒ½æŒ‡æ ‡å¯èƒ½**è™šé«˜**

---

## âœ… æ­£ç¡®åšæ³•

### æ–¹æ¡ˆ A: æ•°æ®åˆ†å‰²ï¼ˆæ¨èï¼‰

å°† `test_response_label.jsonl` åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š

```
åŸå§‹æ•°æ® (17,790)
â”œâ”€â”€ éªŒè¯é›† (3,558 = 20%)   # ç”¨äºä¼˜åŒ–é˜ˆå€¼
â””â”€â”€ æµ‹è¯•é›† (14,232 = 80%)  # ç”¨äºæœ€ç»ˆè¯„ä¼°
```

**æ­¥éª¤**ï¼š

#### 1. åˆ†å‰²æ•°æ®
```bash
cd /home/xgq/Test/detectors

# åˆ†å‰²æ•°æ®é›† (80% æµ‹è¯•, 20% éªŒè¯)
python split_dataset.py \
  --input ../data/test_response_label.jsonl \
  --val-ratio 0.2 \
  --output-val ../data/validation_set.jsonl \
  --output-test ../data/test_set.jsonl
```

**è¾“å‡º**ï¼š
```
âœ“ éªŒè¯é›†: validation_set.jsonl (3,558 æ ·æœ¬)
âœ“ æµ‹è¯•é›†: test_set.jsonl (14,232 æ ·æœ¬)
```

#### 2. åœ¨éªŒè¯é›†ä¸Šä¼˜åŒ–é˜ˆå€¼
```bash
# NLI æ£€æµ‹å™¨åœ¨éªŒè¯é›†ä¸Šè¿è¡Œ
python nli_deberta_detector.py \
  --gpu 0 \
  --input ../data/validation_set.jsonl \
  --output nli_validation_results.jsonl \
  --use-entailment \
  --sentence-level

# ä¼˜åŒ–é˜ˆå€¼
python nli_threshold_optimizer.py \
  --results nli_validation_results.jsonl \
  --use-entailment

# è¾“å‡º: æœ€ä¼˜é˜ˆå€¼ = 0.3500
```

#### 3. åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°
```bash
# ä½¿ç”¨æ‰¾åˆ°çš„æœ€ä¼˜é˜ˆå€¼
python nli_deberta_detector.py \
  --gpu 0 \
  --input ../data/test_set.jsonl \
  --output nli_test_results.jsonl \
  --use-entailment \
  --sentence-level \
  --threshold 0.35  # éªŒè¯é›†ä¼˜åŒ–çš„å€¼
```

---

### æ–¹æ¡ˆ B: ä½¿ç”¨åŸæ•°æ®ï¼ˆå¿«é€Ÿä½†ä¸ä¸¥æ ¼ï¼‰

å¦‚æœä½ åªæ˜¯æƒ³å¿«é€Ÿå®éªŒï¼Œå¯ä»¥ç›´æ¥åœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šä¼˜åŒ–é˜ˆå€¼ï¼š

```bash
# åœ¨å®Œæ•´æ•°æ®é›†ä¸Šè¿è¡Œ
python nli_deberta_detector.py \
  --gpu 0 \
  --input ../data/test_response_label.jsonl \
  --output nli_results.jsonl \
  --use-entailment \
  --sentence-level

# åŸºäºç»“æœä¼˜åŒ–é˜ˆå€¼
python nli_threshold_optimizer.py \
  --results nli_results.jsonl \
  --use-entailment

# å¾—åˆ°æœ€ä¼˜é˜ˆå€¼ï¼ˆå¦‚ 0.3500ï¼‰
```

**é—®é¢˜**ï¼š
- âš ï¸ é˜ˆå€¼åœ¨åŒä¸€æ•°æ®é›†ä¸Šä¼˜åŒ–å’Œè¯„ä¼°
- âš ï¸ æ€§èƒ½æŒ‡æ ‡å¯èƒ½è¿‡äºä¹è§‚
- âš ï¸ ä¸ç¬¦åˆå­¦æœ¯æ ‡å‡†

**é€‚ç”¨äº**ï¼š
- å¿«é€ŸåŸå‹éªŒè¯
- å†…éƒ¨æµ‹è¯•
- ä¸éœ€è¦å‘è¡¨è®ºæ–‡

---

### æ–¹æ¡ˆ C: äº¤å‰éªŒè¯ï¼ˆæœ€ä¸¥æ ¼ï¼‰

å°†æ•°æ®åˆ†ä¸º 5 æŠ˜ï¼Œè½®æµä½œä¸ºéªŒè¯é›†ï¼š

```
Fold 1: ç”¨ Fold 2-5 éªŒè¯, Fold 1 æµ‹è¯•
Fold 2: ç”¨ Fold 1,3-5 éªŒè¯, Fold 2 æµ‹è¯•
...
æœ€ç»ˆç»“æœ: 5æ¬¡æµ‹è¯•çš„å¹³å‡å€¼
```

è¿™ä¸ªæœ€ä¸¥æ ¼ä½†ä¹Ÿæœ€è€—æ—¶ã€‚

---

## ğŸ“‹ æ¨èçš„å·¥ä½œæµç¨‹

### æƒ…å†µ1: ä½ éœ€è¦ä¸¥æ ¼çš„è¯„ä¼°ï¼ˆå¦‚è®ºæ–‡ã€æŠ¥å‘Šï¼‰

âœ… **ä½¿ç”¨æ–¹æ¡ˆ Aï¼ˆæ•°æ®åˆ†å‰²ï¼‰**

```bash
# 1. åˆ†å‰²æ•°æ®
python split_dataset.py

# 2. åœ¨éªŒè¯é›†ä¼˜åŒ–é˜ˆå€¼
python nli_deberta_detector.py --input ../data/validation_set.jsonl --gpu 0 --use-entailment --sentence-level
python nli_threshold_optimizer.py --results nli_deberta_results.jsonl

# 3. åœ¨æµ‹è¯•é›†è¯„ä¼°ï¼ˆä½¿ç”¨æœ€ä¼˜é˜ˆå€¼ï¼‰
python nli_deberta_detector.py --input ../data/test_set.jsonl --gpu 0 --threshold 0.35 --use-entailment --sentence-level
```

---

### æƒ…å†µ2: ä½ åªæ˜¯å¿«é€Ÿå®éªŒ

âœ… **ä½¿ç”¨æ–¹æ¡ˆ Bï¼ˆç›´æ¥è¿è¡Œï¼‰**

```bash
# ç›´æ¥åœ¨å…¨éƒ¨æ•°æ®ä¸Šè¿è¡Œ
python nli_deberta_detector.py --gpu 0 --input ../data/test_response_label.jsonl --use-entailment --sentence-level

# ä¼˜åŒ–é˜ˆå€¼
python nli_threshold_optimizer.py --results nli_deberta_results.jsonl

# è®°å½•ç»“æœå³å¯
```

---

## ğŸ” å½“å‰ BARTScore çš„åšæ³•

ä» `threshold_optimizer.py` çœ‹ï¼š
```python
sample_size=1000  # åªç”¨äº† 1000 ä¸ªæ ·æœ¬
thresholds = np.linspace(..., 100)  # åªæµ‹è¯• 100 ä¸ªé˜ˆå€¼ç‚¹
```

**é—®é¢˜**ï¼š
1. âŒ **æ ·æœ¬å¤ªå°‘**ï¼š1000 vs 17790ï¼ˆåªç”¨äº†5.6%ï¼‰
2. âŒ **æ­¥é•¿å¤ªå¤§**ï¼š100ä¸ªç‚¹ï¼Œæ­¥é•¿çº¦0.06ï¼ˆvs NLIçš„0.01ï¼‰
3. âŒ **æ²¡æœ‰æ˜ç¡®åˆ†ç¦»éªŒè¯é›†å’Œæµ‹è¯•é›†**
4. âŒ **é˜ˆå€¼ -1.8649 å¯èƒ½ä¸æ˜¯çœŸæ­£çš„æœ€ä¼˜**

**è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ**ï¼š
- BARTScore æ€§èƒ½å¯èƒ½è¿˜èƒ½æå‡
- é˜ˆå€¼ä¼˜åŒ–ä¸å¤Ÿç²¾ç¡®
- å­˜åœ¨è¿‡æ‹Ÿåˆé£é™©

---

## ğŸ’¡ å»ºè®®

### å¯¹äº NLIï¼ˆæ–°æ–¹æ³•ï¼‰
âœ… **ä¸¥æ ¼æŒ‰æ ‡å‡†æµç¨‹**ï¼š
```bash
# 1. åˆ†å‰²æ•°æ®ï¼ˆä¸€æ¬¡æ€§æ“ä½œï¼‰
python split_dataset.py

# 2. éªŒè¯é›†ä¼˜åŒ–
python nli_deberta_detector.py --input ../data/validation_set.jsonl --use-entailment --sentence-level --gpu 0
python nli_threshold_optimizer.py --results nli_deberta_results.jsonl

# 3. æµ‹è¯•é›†è¯„ä¼°
python nli_deberta_detector.py --input ../data/test_set.jsonl --threshold [æœ€ä¼˜å€¼] --use-entailment --sentence-level --gpu 0
```

### å¯¹äº BARTScoreï¼ˆå¯é€‰æ”¹è¿›ï¼‰
å¦‚æœä½ æƒ³é‡æ–°ä¼˜åŒ– BARTScore çš„é˜ˆå€¼ï¼Œå¯ä»¥ï¼š
```bash
# ä½¿ç”¨å®Œæ•´éªŒè¯é›†ï¼Œæ›´ç²¾ç»†çš„æ­¥é•¿
# ï¼ˆéœ€è¦ä¿®æ”¹ threshold_optimizer.py çš„æ­¥é•¿å‚æ•°ï¼‰
```

---

## ğŸ“‚ ç”Ÿæˆçš„æ–‡ä»¶

è¿è¡Œ `split_dataset.py` åä¼šç”Ÿæˆï¼š
```
/home/xgq/Test/data/
â”œâ”€â”€ test_response_label.jsonl      # åŸå§‹æ–‡ä»¶ï¼ˆä¿ç•™ï¼‰
â”œâ”€â”€ validation_set.jsonl            # æ–°ï¼šéªŒè¯é›† (20%)
â””â”€â”€ test_set.jsonl                  # æ–°ï¼šæµ‹è¯•é›† (80%)
```

---

## âš ï¸ é‡è¦åŸåˆ™

### é»„é‡‘æ³•åˆ™
```
éªŒè¯é›†: å¯ä»¥åå¤ä½¿ç”¨ï¼Œç”¨äºè°ƒå‚
æµ‹è¯•é›†: åªèƒ½ç”¨ä¸€æ¬¡ï¼Œç”¨äºæœ€ç»ˆè¯„ä¼°

âŒ æ°¸è¿œä¸è¦åœ¨æµ‹è¯•é›†ä¸Šè°ƒå‚ï¼
âŒ æ°¸è¿œä¸è¦æ ¹æ®æµ‹è¯•é›†ç»“æœä¿®æ”¹é˜ˆå€¼ï¼
```

### ä½ ç›®å‰çš„æƒ…å†µ

**BARTScore**ï¼š
- å¯èƒ½åœ¨å…¨éƒ¨17790æ ·æœ¬ä¸Šä¼˜åŒ–äº†é˜ˆå€¼
- ç„¶ååˆåœ¨åŒæ ·çš„17790æ ·æœ¬ä¸Šè¯„ä¼°
- â†’ å­˜åœ¨**ä¿¡æ¯æ³„éœ²**

**åº”è¯¥æ€ä¹ˆåš**ï¼š
1. åˆ†å‰²æ•°æ®
2. åœ¨éªŒè¯é›†ä¼˜åŒ–é˜ˆå€¼
3. åœ¨æµ‹è¯•é›†è¯„ä¼°ï¼ˆåªçœ‹ä¸€æ¬¡ç»“æœï¼‰
4. æŠ¥å‘Šæµ‹è¯•é›†çš„æ€§èƒ½

---

## ğŸš€ ç«‹å³æ“ä½œ

æˆ‘å»ºè®®ä½ ç°åœ¨ï¼š

```bash
cd /home/xgq/Test/detectors

# 1. åˆ†å‰²æ•°æ®é›†ï¼ˆä¸€æ¬¡æ€§ï¼‰
python split_dataset.py

# 2. ç„¶åå‘Šè¯‰æˆ‘ï¼Œæˆ‘ä»¬åœ¨éªŒè¯é›†ä¸Šä¼˜åŒ–é˜ˆå€¼
```

è¿™æ ·æ‰èƒ½å¾—åˆ°**çœŸæ­£å¯é **çš„æ€§èƒ½è¯„ä¼°ï¼

è¦ä¸è¦ç°åœ¨å°±åˆ†å‰²æ•°æ®é›†ï¼Ÿ


