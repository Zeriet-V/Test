# Summary/QA Conflict 子集检测说明

## 🎯 本次检测的目的

验证一个假设：**NLI 对矛盾型幻觉应该有效，问题可能出在 Data2txt 的格式上**

---

## 📊 数据筛选逻辑

### 原始数据（验证集 3,557样本）
```
Summary: 1,136 样本
  ├── 有Conflict: 156
  ├── 有Baseless: (其他幻觉类型)
  └── 无幻觉: 778

QA: 1,207 样本  
  ├── 有Conflict: 79
  ├── 有Baseless: (其他幻觉类型)
  └── 无幻觉: 848

Data2txt: 1,214 样本 (被排除)
```

### 筛选后的数据（1,861样本）
```
只包含:
  ├── Summary Conflict: 156  ← 有矛盾型幻觉
  ├── QA Conflict: 79        ← 有矛盾型幻觉
  ├── Summary 无幻觉: 778
  └── QA 无幻觉: 848

不包含:
  ✗ Baseless Info（无根据信息）
  ✗ Data2txt 任务（格式问题）
```

**目的**: 测试 NLI 在**纯粹的自然语言矛盾检测**上的表现

---

## 🔍 本次检测在测什么

### 检测内容

**有幻觉样本（235个）**:
```
示例:
  原文: "公司成立于2010年，总部在北京..."
  生成: "公司成立于2015年，总部在上海..."  ← Evident Conflict
  
  期望: NLI 判断为 contradiction (矛盾分数高)
```

**无幻觉样本（1,626个）**:
```
示例:
  原文: "公司成立于2010年，总部在北京，员工1000人..."
  生成: "这家公司成立于2010年..."  ← 正确的摘要/答案
  
  期望: NLI 判断为 entailment (蕴含分数高)
```

### 判定标准
```
contradiction_score > 0.5 → 判定为幻觉
```

---

## 📊 本次检测结果

```
准确率: 12.12%  ← 更差了！
召回率: 86.81%
F1分数: 21.27

矛盾分数:
  有幻觉样本: 0.8476
  无幻觉样本: 0.8915
  区分度: 0.044  ← 依然很差
```

### 结果解读

**核心问题**: 
- 矛盾分数依然很高（有幻觉 0.85, 无幻觉 0.89）
- 模型认为**几乎所有样本都是矛盾/中立**
- 甚至无幻觉样本的矛盾分数**更高**（0.89 > 0.85）

**这说明什么？**

1. **不是 Data2txt 格式的问题** 
   - 去掉 Data2txt 后还是不行
   - 问题更深层

2. **可能是文本长度问题**
   - Summary/QA 的原文仍然很长（平均2000+字符）
   - 被截断后，NLI 无法准确判断

3. **或者标注不匹配**
   - 你标注的"Conflict"可能不是 NLI 理解的"逻辑矛盾"
   - 可能是"事实错误"，而 NLI 无法判断事实真假

---

## 💡 为什么无幻觉样本的矛盾分数反而更高？

**可能原因**:

### 情况1: 截断导致
```
原文（很长）: "公司A...（2000字）...总部在北京...（更多内容）"
生成（摘要）: "公司A是一家技术公司"  ← 正确但简洁

NLI看到:
  Premise: "公司A...（前512 tokens，可能不包含关键信息）"
  Hypothesis: "公司A是一家技术公司"
  
判断: 无法从截断的premise推导出hypothesis → Neutral → 矛盾分数0.6-0.9
```

### 情况2: 摘要的泛化
```
原文: "2020年营收100亿，2021年营收120亿"
生成: "公司营收持续增长"  ← 正确的泛化

NLI判断: Neutral（泛化陈述，无法直接推导）→ 矛盾分数0.7
```

### 情况3: 矛盾样本反而更具体
```
原文: "...总部在北京..."
生成: "总部在上海"  ← 错误但具体

NLI判断: Contradiction 0.8（确定矛盾）

vs

原文: "...复杂的业务描述..."  
生成: "公司很成功"  ← 正确但模糊

NLI判断: Neutral 0.9（无法推导）
```

---

## 🔴 最终诊断

### NLI 不适合你的任务，原因：

1. **文本太长**（即使 Summary/QA 也有2000+字符）
2. **摘要/QA 有泛化性**（正确答案也可能被判为neutral）
3. **NLI 无法判断事实**（只能判断逻辑关系）

### 证据
- 全数据集准确率: 43%
- Conflict子集准确率: 28% (更差!)
- Summary/QA子集准确率: **12%** (灾难!)

**结论**: 问题不是 Data2txt，而是 **NLI 方法本身不适合这个任务**

---

## ✅ 最终建议

### 🏆 使用 BARTScore（你的最佳选择）

**已完成的测试**:
```bash
cd /home/xgq/Test/detectors/bartscore_methods
cat bartscore_test_final_results_report.txt
```

**性能**:
- F1分数: **66-68** 
- 准确率: **54-57%**
- 召回率: **84-87%**

**远超 NLI 的所有尝试！**

---

## 📊 实验总结

你已经测试了：

| 方法 | 准确率 | F1 | 结论 |
|------|--------|-----|------|
| BARTScore | **54-57%** | **66-68** | ⭐⭐⭐⭐⭐ 最佳 |
| NLI-entailment(全数据) | 43% | 60 | ❌ |
| NLI-contradiction(全数据) | 43% | 59 | ❌ |
| NLI-Conflict子集 | 28% | 44 | ❌ 更差 |
| NLI-Summary/QA子集 | **12%** | 21 | ❌ 灾难 |

**明确结论**: **BARTScore 是唯一有效的方法**

---

## 🎯 下一步

**停止尝试 NLI**，专注于 BARTScore：

1. **查看 BARTScore 最终结果**
   ```bash
   cd /home/xgq/Test/detectors/bartscore_methods
   cat bartscore_test_final_results_report.txt
   ```

2. **生成最终报告**（如果需要）

3. **考虑 BARTScore 的进一步优化**（可选）

---

**要不要我帮你生成一个完整的实验总结报告？** 包含所有方法的对比和最终结论。
